<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle de Estoque Dark</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #ffffff;
      padding: 20px;
      min-height: 100vh;
    }
    h1, h2 { color: #fffefe; margin-bottom: 10px; }
    .container {
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px; margin: 5px 0; width: 100%;
      border-radius: 5px; font-size: 16px;
      border: none;
    }
    input, select { background: #2c2c2c; color: #575555; }
    button {
      background: #248032; color: #000;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background: #ffffff; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    th, td {
      border: 1px solid #333; padding: 8px; text-align: left;
    }
    th { background-color: #333; color: #ffffff; }
    .btn-delete {
      background: #2c2a2a; color: white; padding: 5px 10px;
      border-radius: 5px; cursor: pointer;
    }
    .btn-delete:hover { background: #b80000; }
    ul { list-style: none; padding-left: 0; margin-top: 10px; }
    ul li {
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .filter { width: 50%; margin: 10px 0; }
    .btn-mini {
      width: 25px;
      height: 25px;
      margin-left: 5px;
      font-size: 14px;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      padding: 0;
    }

    /* MODAL ESTILO CLEAN */
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal-content {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 20px;
      width: 300px;
      box-shadow: 0 0 10px #000;
    }
    .modal-content h3 {
      margin-bottom: 10px;
    }
    .modal-content input {
      width: 100%;
    }
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<h1>BOMBARDI CONTROL</h1>
<button onclick="window.location.href='entregas.html'" style="margin: 10px 0; background: #00ff88;">üöö √Årea de Entregas</button>

<div class="container">
  <h2>Cadastro de Categorias</h2>
  <input type="text" id="categoriaInput" placeholder="Nome da categoria">
  <button onclick="adicionarCategoria()">Adicionar Categoria</button>
  <ul id="listaCategorias"></ul>
</div>

<div class="container">
  <h2>Cadastro de Materiais</h2>
  <input type="text" id="materialInput" placeholder="Nome do material">
  <input type="number" id="quantidadeInput" placeholder="Quantidade inicial">
  <select id="categoriaSelect"></select>
  <button onclick="adicionarMaterial()">Adicionar Material</button>
  <ul id="listaMateriaisSimples"></ul>
</div>

<div class="container">
  <h2>Lista de Materiais</h2>
  <input type="text" id="filtroInput" class="filter" placeholder="Filtrar por nome..." oninput="atualizarListaMateriais()">
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Quantidade</th>
        <th>A√ß√£o</th>
      </tr>
    </thead>
    <tbody id="tabelaMateriais"></tbody>
  </table>
</div>

<!-- MODAL DE EDI√á√ÉO -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Editar</h3>
    <input type="text" id="editNome" placeholder="Nome">
    <input type="text" id="editCategoria" placeholder="Categoria">
    <input type="number" id="editQuantidade" placeholder="Quantidade">
    <div class="modal-buttons">
      <button onclick="salvarEdicao()">Salvar</button>
      <button onclick="fecharModal()">Cancelar</button>
    </div>
  </div>
</div>

<script>
let categorias = JSON.parse(localStorage.getItem('categorias') || '[]');
let materiais = JSON.parse(localStorage.getItem('materiais') || '[]');

let modoEdicao = ''; // 'categoria' ou 'material'
let indexEdicao = null;

function salvarDados() {
  localStorage.setItem('categorias', JSON.stringify(categorias));
  localStorage.setItem('materiais', JSON.stringify(materiais));
}

function adicionarCategoria() {
  const nome = document.getElementById("categoriaInput").value.trim();
  if (!nome || categorias.includes(nome)) return;
  categorias.push(nome);
  document.getElementById("categoriaInput").value = '';
  salvarDados();
  atualizarCategorias();
}

function atualizarCategorias() {
  const select = document.getElementById("categoriaSelect");
  const lista = document.getElementById("listaCategorias");
  select.innerHTML = '<option value="">Selecione uma categoria</option>';
  lista.innerHTML = '';
  categorias.forEach((cat, i) => {
    select.innerHTML += `<option value="${cat}">${cat}</option>`;
    lista.innerHTML += `<li>${cat}
      <span>
        <button class='btn-delete btn-mini' onclick='abrirModalCategoria(${i})'>‚úèÔ∏è</button>
        <button class='btn-delete btn-mini' onclick='excluirCategoria(${i})'>‚úñ</button>
      </span>
    </li>`;
  });
}

function abrirModalCategoria(i) {
  modoEdicao = 'categoria';
  indexEdicao = i;
  document.getElementById('modalTitle').innerText = "Editar Categoria";
  document.getElementById('editNome').value = categorias[i];
  document.getElementById('editCategoria').style.display = 'none';
  document.getElementById('editQuantidade').style.display = 'none';
  document.getElementById('modal').style.display = 'flex';
}

function abrirModalMaterial(i) {
  modoEdicao = 'material';
  indexEdicao = i;
  let mat = materiais[i];
  document.getElementById('modalTitle').innerText = "Editar Material";
  document.getElementById('editNome').value = mat.nome;
  document.getElementById('editCategoria').value = mat.categoria;
  document.getElementById('editQuantidade').value = mat.quantidade;
  document.getElementById('editCategoria').style.display = 'block';
  document.getElementById('editQuantidade').style.display = 'block';
  document.getElementById('modal').style.display = 'flex';
}

function fecharModal() {
  document.getElementById('modal').style.display = 'none';
}

function salvarEdicao() {
  const nome = document.getElementById('editNome').value.trim();
  const categoria = document.getElementById('editCategoria').value.trim();
  const quantidade = parseInt(document.getElementById('editQuantidade').value);

  if (modoEdicao === 'categoria') {
    if (!nome || categorias.includes(nome)) return;
    const nomeAntigo = categorias[indexEdicao];
    categorias[indexEdicao] = nome;
    materiais = materiais.map(m => m.categoria === nomeAntigo ? { ...m, categoria: nome } : m);
  }

  if (modoEdicao === 'material') {
    if (!nome || !categoria || isNaN(quantidade)) return;
    materiais[indexEdicao] = { nome, categoria, quantidade };
  }

  salvarDados();
  atualizarCategorias();
  atualizarMateriais();
  fecharModal();
}

function excluirCategoria(index) {
  const nomeCat = categorias[index];
  const usados = materiais.some(m => m.categoria === nomeCat);
  if (usados) return alert("Categoria em uso.");
  if (confirm("Deseja excluir esta categoria?")) {
    categorias.splice(index, 1);
    salvarDados();
    atualizarCategorias();
  }
}

function adicionarMaterial() {
  const nome = document.getElementById("materialInput").value.trim();
  const categoria = document.getElementById("categoriaSelect").value;
  const quantidade = parseInt(document.getElementById("quantidadeInput").value);
  if (!nome || !categoria || isNaN(quantidade)) return;
  materiais.push({ nome, categoria, quantidade });
  document.getElementById("materialInput").value = '';
  document.getElementById("quantidadeInput").value = '';
  salvarDados();
  atualizarMateriais();
}

function atualizarMateriais() {
  const lista = document.getElementById("listaMateriaisSimples");
  const tbody = document.getElementById("tabelaMateriais");
  lista.innerHTML = '';
  tbody.innerHTML = '';
  materiais.forEach((m, i) => {
    lista.innerHTML += `<li>${m.nome} (${m.categoria}) - ${m.quantidade}</li>`;
    tbody.innerHTML += `<tr>
      <td>${m.nome}</td>
      <td>${m.categoria}</td>
      <td>${m.quantidade}</td>
      <td>
        <button class='btn-delete btn-mini' onclick='abrirModalMaterial(${i})'>‚úèÔ∏è</button>
        <button class='btn-delete btn-mini' onclick='excluirMaterial(${i})'>‚úñ</button>
      </td>
    </tr>`;
  });
}

function excluirMaterial(i) {
  if (confirm("Deseja excluir este material?")) {
    materiais.splice(i, 1);
    salvarDados();
    atualizarMateriais();
  }
}

function atualizarListaMateriais() {
  atualizarMateriais(); // j√° faz o filtro tamb√©m
}

atualizarCategorias();
atualizarMateriais();
</script>
</body>
</html>
