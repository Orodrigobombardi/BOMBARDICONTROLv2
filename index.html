<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle de Estoque Dark</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      padding: 20px;
      min-height: 100vh;
    }
    h1, h2 { color: #ffffff; margin-bottom: 10px; }
    .container {
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px; margin: 5px 0; width: 100%;
      border-radius: 5px; font-size: 16px;
      border: none;
    }
    input, select { background: #2c2c2c; color: #f0f0f0; }
    button {
      background: #ffffff; color: #000;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background: #ffffff; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    th, td {
      border: 1px solid #333; padding: 8px; text-align: left;
    }
    th { background-color: #333; color: #ffffff; }
    .btn-delete {
      background: #ff4c4c; color: white; padding: 5px 10px;
      border-radius: 5px; cursor: pointer;
    }
    .btn-delete:hover { background: #b80000; }
    ul { list-style: none; padding-left: 0; margin-top: 10px; }
    ul li { margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
    .filter { width: 50%; margin: 10px 0; }
  </style>
</head>
<body>

<h1>BOMBARDI CONTROL</h1>

<div class="container">
  <h2>Cadastro de Categorias</h2>
  <input type="text" id="categoriaInput" placeholder="Nome da categoria">
  <button onclick="adicionarCategoria()">Adicionar Categoria</button>
  <ul id="listaCategorias"></ul>
</div>

<div class="container">
  <h2>Cadastro de Materiais</h2>
  <input type="text" id="materialInput" placeholder="Nome do material">
  <input type="number" id="quantidadeInput" placeholder="Quantidade inicial">
  <select id="categoriaSelect"></select>
  <button onclick="adicionarMaterial()">Adicionar Material</button>
  <ul id="listaMateriaisSimples"></ul>
</div>

<div class="container">
  <h2>Movimentação de Estoque</h2>
  <select id="materialSelect"></select>
  <input type="number" id="qtdMovimentacao" placeholder="Quantidade">
  <select id="tipoMovimentacao">
    <option value="entrada">Entrada</option>
    <option value="saida">Saída</option>
  </select>
  <button onclick="registrarMovimentacao()">Registrar</button>
</div>

<div class="container">
  <h2>Lista de Materiais</h2>
  <input type="text" id="filtroInput" class="filter" placeholder="Filtrar por nome..." oninput="atualizarListaMateriais()">
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Quantidade</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody id="tabelaMateriais"></tbody>
  </table>
</div>

<div class="container">
  <h2>Relatório de Movimentações</h2>
  <button onclick="gerarPDF()">Gerar PDF</button>
  <input type="text" id="filtroMovimento" class="filter" placeholder="Filtrar por nome, tipo ou data..." oninput="atualizarRelatorio()">
  <table>
    <thead>
      <tr>
        <th>Data</th>
        <th>Material</th>
        <th>Tipo</th>
        <th>Quantidade</th>
      </tr>
    </thead>
    <tbody id="tabelaMovimentos"></tbody>
  </table>
</div>
<button onclick="apagarRelatorio()" class="btn-delete">Apagar Relatório</button>
  <table>
    <thead>      
    </thead>
    <tbody id="tabelaMovimentos"></tbody>
  </table>
</div>

<script>
let categorias = JSON.parse(localStorage.getItem('categorias') || '[]');
let materiais = JSON.parse(localStorage.getItem('materiais') || '[]');
let movimentos = JSON.parse(localStorage.getItem('movimentos') || '[]');

function salvarDados() {
  localStorage.setItem('categorias', JSON.stringify(categorias));
  localStorage.setItem('materiais', JSON.stringify(materiais));
  localStorage.setItem('movimentos', JSON.stringify(movimentos));
}

function adicionarCategoria() {
  const nome = document.getElementById("categoriaInput").value.trim();
  if (!nome || categorias.includes(nome)) return;
  categorias.push(nome);
  document.getElementById("categoriaInput").value = '';
  salvarDados();
  atualizarCategorias();
}

function excluirCategoria(index) {
  const nomeCat = categorias[index];
  const usados = materiais.some(m => m.categoria === nomeCat);
  if (usados) {
    alert("Essa categoria está sendo usada por materiais e não pode ser excluída.");
    return;
  }
  if (confirm("Deseja excluir essa categoria?")) {
    categorias.splice(index, 1);
    salvarDados();
    atualizarCategorias();
  }
}

function atualizarCategorias() {
  const select = document.getElementById("categoriaSelect");
  const lista = document.getElementById("listaCategorias");
  select.innerHTML = '<option value="">Selecione uma categoria</option>';
  lista.innerHTML = '';
  categorias.forEach((cat, i) => {
    select.innerHTML += `<option value="${cat}">${cat}</option>`;
    lista.innerHTML += `<li>${cat} <button class='btn-delete' onclick='excluirCategoria(${i})'>Excluir</button></li>`;
  });
}

function adicionarMaterial() {
  const nome = document.getElementById("materialInput").value.trim();
  const categoria = document.getElementById("categoriaSelect").value;
  const quantidade = parseInt(document.getElementById("quantidadeInput").value);
  if (!nome || !categoria || isNaN(quantidade)) return;
  materiais.push({ nome, categoria, quantidade });
  document.getElementById("materialInput").value = '';
  document.getElementById("quantidadeInput").value = '';
  salvarDados();
  atualizarMateriais();
}

function atualizarMateriais() {
  const select = document.getElementById("materialSelect");
  const lista = document.getElementById("listaMateriaisSimples");
  select.innerHTML = '<option value="">Selecione</option>';
  lista.innerHTML = '';
  materiais.forEach((m, i) => {
    select.innerHTML += `<option value="${i}">${m.nome} (${m.quantidade})</option>`;
    lista.innerHTML += `<li>${m.nome} (${m.categoria}) - ${m.quantidade}</li>`;
  });
  atualizarListaMateriais();
}

function registrarMovimentacao() {
  const index = document.getElementById("materialSelect").value;
  const qtd = parseInt(document.getElementById("qtdMovimentacao").value);
  const tipo = document.getElementById("tipoMovimentacao").value;
  if (index === "" || isNaN(qtd) || qtd <= 0) return;
  const material = materiais[index];
  if (tipo === "saida" && material.quantidade < qtd) return alert("Estoque insuficiente");
  material.quantidade += tipo === "entrada" ? qtd : -qtd;
  movimentos.push({ data: new Date().toLocaleString(), nome: material.nome, tipo, quantidade: qtd });
  salvarDados();
  atualizarMateriais();
  atualizarRelatorio();
}

function atualizarListaMateriais() {
  const filtro = document.getElementById("filtroInput").value.toLowerCase();
  const tbody = document.getElementById("tabelaMateriais");
  tbody.innerHTML = '';
  materiais
    .filter(m => m.nome.toLowerCase().includes(filtro))
    .forEach((m, i) => {
      tbody.innerHTML += `<tr>
        <td>${m.nome}</td><td>${m.categoria}</td><td>${m.quantidade}</td>
        <td><button class='btn-delete' onclick='excluirMaterial(${i})'>Excluir</button></td>
      </tr>`;
    });
}

function excluirMaterial(i) {
  if (confirm("Deseja excluir este material?")) {
    materiais.splice(i, 1);
    salvarDados();
    atualizarMateriais();
  }
}

function atualizarRelatorio() {
  const filtro = document.getElementById("filtroMovimento")?.value?.toLowerCase() || "";
  const corpo = document.getElementById("tabelaMovimentos");
  corpo.innerHTML = '';
  movimentos
    .filter(m =>
      m.nome.toLowerCase().includes(filtro) ||
      m.tipo.toLowerCase().includes(filtro) ||
      m.data.toLowerCase().includes(filtro)
    )
    .forEach(m => {
      corpo.innerHTML += `<tr><td>${m.data}</td><td>${m.nome}</td><td>${m.tipo}</td><td>${m.quantidade}</td></tr>`;
    });
}


function gerarPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(18);
  doc.text("Relatório de Movimentações", 14, 20);
  const linhas = movimentos.map(m => [m.data, m.nome, m.tipo.toUpperCase(), m.quantidade]);
  doc.autoTable({ head: [['Data', 'Material', 'Tipo', 'Quantidade']], body: linhas, startY: 30 });
  doc.save("relatorio_movimentos.pdf");
}

atualizarCategorias();
atualizarMateriais();
atualizarRelatorio();
function apagarRelatorio() {
  if (confirm("Tem certeza que deseja apagar todo o relatório de movimentações?")) {
    movimentos = [];
    salvarDados();
    atualizarRelatorio();
  }
}

atualizarCategorias();
atualizarMateriais();
atualizarRelatorio();
</script>
</body>
</html>

</script>
</body>
</html>

