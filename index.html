<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Controle de Estoque Dark</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #f0f0f0;
      padding: 20px;
      min-height: 100vh;
    }
    h1, h2 { color: #ffffff; margin-bottom: 10px; }
    .container {
      background-color: #1e1e1e;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px; margin: 5px 0; width: 100%;
      border-radius: 5px; font-size: 16px;
      border: none;
    }
    input, select { background: #2c2c2c; color: #f0f0f0; }
    button {
      background: #ffffff; color: #000;
      font-weight: bold; cursor: pointer;
    }
    button:hover { background: #ffffff; }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px;
    }
    th, td {
      border: 1px solid #333; padding: 8px; text-align: left;
    }
    th { background-color: #333; color: #ffffff; }
    .btn-delete {
      background: #ff4c4c; color: white; padding: 5px 10px;
      border-radius: 5px; cursor: pointer;
    }
    .btn-delete:hover { background: #b80000; }
    ul { list-style: none; padding-left: 0; margin-top: 10px; }
    ul li { margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
    .filter { width: 50%; margin: 10px 0; }

    .btn-mini {
  width: 25px;
  height: 25px;
  padding: 0;
  margin-left: 10px;
  font-size: 14px;
  line-height: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}
  </style>
</head>
<body>

<h1>BOMBARDI CONTROL</h1>
<button onclick="window.location.href='registro_entregas.html'" style="margin: 10px 0; background: #00ff88;">üì¶ Registrar Entregas</button>

<div class="container">
  <h2>Cadastro de Categorias</h2>
  <input type="text" id="categoriaInput" placeholder="Nome da categoria">
  <button onclick="adicionarCategoria()">Adicionar Categoria</button>
  <ul id="listaCategorias"></ul>
</div>

<div class="container">
  <h2>Cadastro de Materiais</h2>
  <input type="text" id="materialInput" placeholder="Nome do material">
  <input type="number" id="quantidadeInput" placeholder="Quantidade inicial">
  <select id="categoriaSelect"></select>
  <button onclick="adicionarMaterial()">Adicionar Material</button>
  <ul id="listaMateriaisSimples"></ul>
</div>

<div class="container">
  <h2>Lista de Materiais</h2>
  <input type="text" id="filtroInput" class="filter" placeholder="Filtrar por nome..." oninput="atualizarListaMateriais()">
  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Categoria</th>
        <th>Quantidade</th>
        <th>A√ß√£o</th>
      </tr>
    </thead>
    <tbody id="tabelaMateriais"></tbody>
  </table>
</div>

<!-- select usado para movimenta√ß√£o futura -->
<select id="materialSelect" style="display: none;"></select>

<script>
let categorias = JSON.parse(localStorage.getItem('categorias') || '[]');
let materiais = JSON.parse(localStorage.getItem('materiais') || '[]');
let movimentos = JSON.parse(localStorage.getItem('movimentos') || '[]');

function salvarDados() {
  localStorage.setItem('categorias', JSON.stringify(categorias));
  localStorage.setItem('materiais', JSON.stringify(materiais));
  localStorage.setItem('movimentos', JSON.stringify(movimentos));
}

function adicionarCategoria() {
  const nome = document.getElementById("categoriaInput").value.trim();
  if (!nome || categorias.includes(nome)) return;
  categorias.push(nome);
  document.getElementById("categoriaInput").value = '';
  salvarDados();
  atualizarCategorias();
}

function excluirCategoria(index) {
  const nomeCat = categorias[index];
  const usados = materiais.some(m => m.categoria === nomeCat);
  if (usados) {
    alert("Essa categoria est√° sendo usada por materiais e n√£o pode ser exclu√≠da.");
    return;
  }
  if (confirm("Deseja excluir essa categoria?")) {
    categorias.splice(index, 1);
    salvarDados();
    atualizarCategorias();
  }
}

function atualizarCategorias() {
  const select = document.getElementById("categoriaSelect");
  const lista = document.getElementById("listaCategorias");
  select.innerHTML = '<option value="">Selecione uma categoria</option>';
  lista.innerHTML = '';
  categorias.forEach((cat, i) => {
    select.innerHTML += `<option value="${cat}">${cat}</option>`;
    lista.innerHTML += `<li>${cat}<button class='btn-delete btn-mini' onclick='excluirCategoria(${i})'>‚úñ</button></li>`;
  });
}

function adicionarMaterial() {
  const nome = document.getElementById("materialInput").value.trim();
  const categoria = document.getElementById("categoriaSelect").value;
  const quantidade = parseInt(document.getElementById("quantidadeInput").value);
  if (!nome || !categoria || isNaN(quantidade)) return;
  materiais.push({ nome, categoria, quantidade });
  document.getElementById("materialInput").value = '';
  document.getElementById("quantidadeInput").value = '';
  salvarDados();
  atualizarMateriais();
}

function atualizarMateriais() {
  const select = document.getElementById("materialSelect");
  const lista = document.getElementById("listaMateriaisSimples");
  select.innerHTML = '<option value="">Selecione</option>';
  lista.innerHTML = '';
  materiais.forEach((m, i) => {
    select.innerHTML += `<option value="${i}">${m.nome} (${m.quantidade})</option>`;
    lista.innerHTML += `<li>${m.nome} (${m.categoria}) - ${m.quantidade}</li>`;
  });
  atualizarListaMateriais();
}

function atualizarListaMateriais() {
  const filtro = document.getElementById("filtroInput").value.toLowerCase();
  const tbody = document.getElementById("tabelaMateriais");
  tbody.innerHTML = '';
  materiais
    .filter(m => m.nome.toLowerCase().includes(filtro))
    .forEach((m, i) => {
      tbody.innerHTML += `<tr>
        <td>${m.nome}</td>
        <td>${m.categoria}</td>
        <td>${m.quantidade}</td>
        <td><button class='btn-delete' onclick='excluirMaterial(${i})'>Excluir</button></td>
      </tr>`;
    });
}

function excluirMaterial(i) {
  if (confirm("Deseja excluir este material?")) {
    materiais.splice(i, 1);
    salvarDados();
    atualizarMateriais();
  }
}

function atualizarRelatorio() {
  // Aqui √© para futura integra√ß√£o de relat√≥rio
}

atualizarCategorias();
atualizarMateriais();
</script>
</body>
</html>
